
<!DOCTYPE html>

<html>
<head>
    <title>ORouter</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <!-- Enable responsiveness on mobile devices-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="dappspec.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <table class="docs" cellpadding="0" cellspacing="0">
      <tbody>
          
          <tr id="section-1">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
                
            </td>
            <td class="code">
                <div class="highlight"><pre><span></span><span class="c1">// SPDX-License-Identifier: UNLICENSED</span>
<span class="k">pragma solidity</span><span class="w"> </span><span class="o">&gt;=</span><span class="k">0.8.13</span><span class="w"> </span><span class="o">&lt;</span><span class="k">0.9.0</span><span class="p">;</span><span class="w"></span>

<span class="cm">/** </span>
<span class="cm">Optimal MEV router contract (IUniswapV2Router compatible)</span>

<span class="cm">For the User it aims to offer:</span>
<span class="cm">  1. Better order routing for minimal slippage</span>
<span class="cm">  2. At source MEV</span>
<span class="cm">  3. Lower gas costs for swaps and liquidity changes</span>

<span class="cm">For the Liquidity providers:</span>
<span class="cm">  1. Inclusive rewards</span>
<span class="cm">  2. Reduced impermanent loss</span>

<span class="cm">For the Exchange providers:</span>
<span class="cm">  1. Inclusive rewards</span>
<span class="cm">  2. Increased adoption</span>

<span class="cm">For the Ethereum environment:</span>
<span class="cm">  1. Reduced MEV attacks and fee spikes</span>
<span class="cm">  2. Healthy growth in MEV space with inclusive incentives</span>

<span class="cm">Version 1 MEV Strategies</span>
<span class="cm">  - cross-dex backruns for swaps</span>
<span class="cm">  - reduced slippage fallback router </span>

<span class="cm">The contract leverages and depends on 3 external protocols:</span>
<span class="cm">  1. Uniswap V2 (or equivalent on another network) for backrun completion and fallback swaps</span>
<span class="cm">  2. BentoBox for flashloan backruns</span>
<span class="cm">  3. Aave V2 for flashloan backruns that require more liquidity than BentoBox has </span>

<span class="cm">Business logic</span>
<span class="cm">  - Profits from backruns are retained on the contract to improve efficiency (gas cost and profit) of future backruns</span>
<span class="cm">  - Contract should therefore be deployed or ownership transfered to a multisig address</span>
<span class="cm">  - Harvest function can be called from the multisig owners to distribute profits by consensus </span>

<span class="cm">Resources</span>
<span class="cm">  - IUniswapV2Router: https://github.com/Uniswap/v2-periphery/blob/master/contracts/interfaces/IUniswapV2Router02.sol</span>
<span class="cm">  - Contract size reduction techniques: https://ethereum.org/en/developers/tutorials/downsizing-contracts-to-fight-the-contract-size-limit/</span>
<span class="cm">  - Contract gas reduction techniques: https://gist.github.com/hrkrshnn/ee8fabd532058307229d65dcd5836ddc</span>

<span class="cm">Dev Notes</span>
<span class="cm">  - Normal sushiswap router functions. Swaps have 2 material changes:</span>
<span class="cm">      1) slippage fallback router (uniswap v2)</span>
<span class="cm">      2) backruns after user swap</span>
<span class="cm">  - For gas and size efficiency, requires are modified to reverts with custom errors</span>
<span class="cm">  - Factory hash is now passed to library functions because we are working with 2 factories</span>
<span class="cm">  - Other changes are trade-offs for reducing contract size and / or gas usage and stack too deep errors</span>
<span class="cm">*/</span><span class="w"></span></pre></div>
            </td>
          </tr>
          
          <tr id="section-2">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-2">&#182;</a>
              </div>

              
                <p>============ Internal Imports ============</p>

            </td>
            <td class="code">
                
            </td>
          </tr>
          
          <tr id="section-3">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h3>@title OpenMevRouter</h3>
                <p>  <br />
@author Sandy Bradley <a href="mailto:sandy@manifoldx.com">sandy@manifoldx.com</a>, <br /> 
Sam Bacha <a href="mailto:sam@manifoldfinance.com">sam@manifoldfinance.com</a>  <br />  <br />
@notice Optimal MEV router <strong>contract</strong> (IUniswapV2Router compatible)</p> <br />

            </td>
            <td class="code">
                <div class="highlight"><pre><span class="k">contract</span><span class="w"> </span><span class="ni">OpenMevRouter</span><span class="w"> </span><span class="kt">is</span><span class="w"> </span>IFlashBorrower<span class="p">,</span><span class="w"> </span>IOpenMevRouter<span class="p">,</span><span class="w"> </span>TwoStepOwnable<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span>using<span class="w"> </span>SafeTransferLib<span class="w"> </span><span class="kt">for</span><span class="w"> </span>ERC20<span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Custom errors save gas, encoding to 4 bytes</span>
<span class="w">    </span>error<span class="w"> </span>Expired<span class="p">();</span><span class="w"></span>
<span class="w">    </span>error<span class="w"> </span>NoTokens<span class="p">();</span><span class="w"></span>
<span class="w">    </span>error<span class="w"> </span>NotPercent<span class="p">();</span><span class="w"></span>
<span class="w">    </span>error<span class="w"> </span>NoReceivers<span class="p">();</span><span class="w"></span>
<span class="w">    </span>error<span class="w"> </span>InvalidPath<span class="p">();</span><span class="w"></span>
<span class="w">    </span>error<span class="w"> </span>TransferFailed<span class="p">();</span><span class="w"></span>
<span class="w">    </span>error<span class="w"> </span>InsufficientBAmount<span class="p">();</span><span class="w"></span>
<span class="w">    </span>error<span class="w"> </span>InsufficientAAmount<span class="p">();</span><span class="w"></span>
<span class="w">    </span>error<span class="w"> </span>TokenIsFeeOnTransfer<span class="p">();</span><span class="w"></span>
<span class="w">    </span>error<span class="w"> </span>ExcessiveInputAmount<span class="p">();</span><span class="w"></span>
<span class="w">    </span>error<span class="w"> </span>ExecuteNotAuthorized<span class="p">();</span><span class="w"></span>
<span class="w">    </span>error<span class="w"> </span>InsufficientAllowance<span class="p">();</span><span class="w"></span>
<span class="w">    </span>error<span class="w"> </span>InsufficientLiquidity<span class="p">();</span><span class="w"></span>
<span class="w">    </span>error<span class="w"> </span>InsufficientOutputAmount<span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">MEV</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>user<span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>token<span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">value</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="kt">event</span><span class="w"> </span><span class="nv">LoanError</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">indexed</span><span class="w"> </span>token<span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountIn</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span>bytes4<span class="w"> </span><span class="kt">internal</span><span class="w"> </span><span class="kt">constant</span><span class="w"> </span>SWAP_SELECTOR<span class="w"> </span><span class="o">=</span><span class="w"> </span>bytes4<span class="p">(</span><span class="nb">keccak256</span><span class="p">(</span><span class="s2">&quot;swap(uint256,uint256,address,bytes)&quot;</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="k">internal </span><span class="nv">constant</span><span class="w"> </span>WETH09<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="k">internal </span><span class="nv">constant</span><span class="w"> </span>BACKUP_FACTORY<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x5C69bEe701ef814a2B6a3EDD4B1652CB9cc5aA6f</span><span class="p">;</span><span class="w"> </span><span class="c1">// uniswap v2 factory</span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="k">internal </span><span class="nv">constant</span><span class="w"> </span>LENDING_POOL_ADDRESS<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x7d2768dE32b0b80b7a3454c06BdAc94A69DDc7A9</span><span class="p">;</span><span class="w"> </span><span class="c1">// aave lending pool address</span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="k">internal </span><span class="nv">constant</span><span class="w"> </span>BENTO<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xF5BCE5077908a1b7370B9ae04AdC565EBd643966</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kt">address</span><span class="w"> </span><span class="k">internal </span><span class="nv">constant</span><span class="w"> </span>AAVE_DATA_PROVIDER<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x057835Ad21a177dbdd3090bB1CAE03EaCF78Fc6d</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span>IBentoBoxV1<span class="w"> </span><span class="kt">internal</span><span class="w"> </span><span class="kt">constant</span><span class="w"> </span>bento<span class="w"> </span><span class="o">=</span><span class="w"> </span>IBentoBoxV1<span class="p">(</span><span class="mh">0xF5BCE5077908a1b7370B9ae04AdC565EBd643966</span><span class="p">);</span><span class="w"> </span><span class="c1">// BENTO vault contract</span>
<span class="w">    </span><span class="kt">mapping</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>IS_AAVE_ASSET<span class="p">;</span><span class="w"> </span><span class="c1">// boolean address mapping for flagging aave assets</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * <br /> @dev Initialize contract by setting aave assets</span> <br />
<span class="cm">     */</span><span class="w"></span>
<span class="w">    </span><span class="kt">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>aaveAssets<span class="w"> </span><span class="o">=</span><span class="w"> </span>ILendingPool<span class="p">(</span>LENDING_POOL_ADDRESS<span class="p">).</span>getReservesList<span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>aaveAssets<span class="p">.</span>length<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">i</span><span class="p">;</span><span class="w"> </span>i<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>length<span class="p">;</span><span class="w"> </span>i<span class="w"> </span><span class="o">=</span><span class="w"> </span>_inc<span class="p">(</span>i<span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kt">address</span><span class="w"> </span><span class="nv">asset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>aaveAssets<span class="p">[</span>i<span class="p">];</span><span class="w"></span>
<span class="w">            </span>IS_AAVE_ASSET<span class="p">[</span>asset<span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">true</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span></pre></div>
            </td>
          </tr>
          
          <tr id="section-4">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
                <h4>@notice</h4> <p> Ensures deadline is not passed, otherwise revert. (0 = no deadline) <br />
<br /> @dev Modifier has been replaced with a function for gas efficiency <br />
@param deadline Unix timestamp in seconds for transaction to execute before</p> <br />

            </td>
            <td class="code">
                <div class="highlight"><pre><span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">ensure</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">deadline</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>view<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>deadline<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">block.timestamp</span><span class="p">)</span><span class="w"> </span>revert<span class="w"> </span>Expired<span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span></pre></div>
            </td>
          </tr>
          
          <tr id="section-5">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
                <h4>@notice</h4> <p> Checks amounts for token A and token B are balanced for pool. Creates a pair if none exists <br />
<br /> @dev Reverts with custom errors replace requires <br />
@param tokenA Token in pool <br />
@param tokenB Token in pool <br />
@param amountADesired Amount of token A desired to add to pool <br />
@param amountBDesired Amount of token B desired to add to pool <br />
@param amountAMin Minimum amount of token A, can be 0 <br />
@param amountBMin Minimum amount of token B, can be 0 <br />
<br />
@return amountA exact amount of token A to be added
@return amountB exact amount of token B to be added <br /></p>

            </td>
            <td class="code">
                <div class="highlight"><pre><span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">_addLiquidity</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">tokenA</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">tokenB</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountADesired</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountBDesired</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountAMin</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountBMin</span><span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>virtual<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountA</span><span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountB</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// create the pair if it doesn&#39;t exist yet</span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">factory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>OpenMevLibrary<span class="p">.</span>SUSHI_FACTORY<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>IUniswapV2Factory<span class="p">(</span>factory<span class="p">).</span>getPair<span class="p">(</span>tokenA<span class="p">,</span><span class="w"> </span>tokenB<span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kt">address</span><span class="p">(</span><span class="m m-Decimal">0</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span>IUniswapV2Factory<span class="p">(</span>factory<span class="p">).</span>createPair<span class="p">(</span>tokenA<span class="p">,</span><span class="w"> </span>tokenB<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">reserveA</span><span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">reserveB</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>OpenMevLibrary<span class="p">.</span>getReserves<span class="p">(</span>factory<span class="p">,</span><span class="w"> </span>tokenA<span class="p">,</span><span class="w"> </span>tokenB<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>_isZero<span class="p">(</span>reserveA<span class="p">)</span><span class="w"> </span><span class="err">&amp;&amp;</span><span class="w"> </span>_isZero<span class="p">(</span>reserveB<span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="p">(</span>amountA<span class="p">,</span><span class="w"> </span>amountB<span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>amountADesired<span class="p">,</span><span class="w"> </span>amountBDesired<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="kt">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountBOptimal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>OpenMevLibrary<span class="p">.</span>quote<span class="p">(</span>amountADesired<span class="p">,</span><span class="w"> </span>reserveA<span class="p">,</span><span class="w"> </span>reserveB<span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>amountBOptimal<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span>amountBDesired<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountAOptimal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>OpenMevLibrary<span class="p">.</span>quote<span class="p">(</span>amountBDesired<span class="p">,</span><span class="w"> </span>reserveB<span class="p">,</span><span class="w"> </span>reserveA<span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>amountAOptimal<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span>amountADesired<span class="p">)</span><span class="w"> </span>revert<span class="w"> </span>InsufficientAAmount<span class="p">();</span><span class="w"></span>
<span class="w">                </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>amountAOptimal<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>amountAMin<span class="p">)</span><span class="w"> </span>revert<span class="w"> </span>InsufficientAAmount<span class="p">();</span><span class="w"></span>
<span class="w">                </span><span class="p">(</span>amountA<span class="p">,</span><span class="w"> </span>amountB<span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>amountAOptimal<span class="p">,</span><span class="w"> </span>amountBDesired<span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="kt">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>amountBOptimal<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>amountBMin<span class="p">)</span><span class="w"> </span>revert<span class="w"> </span>InsufficientBAmount<span class="p">();</span><span class="w"></span>
<span class="w">                </span><span class="p">(</span>amountA<span class="p">,</span><span class="w"> </span>amountB<span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>amountADesired<span class="p">,</span><span class="w"> </span>amountBOptimal<span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span></pre></div>
            </td>
          </tr>
          
          <tr id="section-6">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
                <h4>@notice</h4> <p> Adds liquidity to an ERC-20⇄ERC-20 pool. msg.sender should have already given the router an allowance of at least amountADesired/amountBDesired on tokenA/tokenB <br />
@param tokenA Token in pool <br />
@param tokenB Token in pool <br />
@param amountADesired Amount of token A desired to add to pool <br />
@param amountBDesired Amount of token B desired to add to pool <br />
@param amountAMin Minimum amount of token A, can be 0 <br />
@param amountBMin Minimum amount of token B, can be 0 <br />
@param to Address to receive liquidity token <br />
@param deadline Unix timestamp in seconds after which the transaction will revert <br />
@return amountA exact amount of token A added to pool <br />
@return amountB exact amount of token B added to pool <br />
@return liquidity amount of liquidity token received <br /></p>

            </td>
            <td class="code">
                <div class="highlight"><pre><span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">addLiquidity</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">tokenA</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">tokenB</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountADesired</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountBDesired</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountAMin</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountBMin</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">to</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">deadline</span><span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="kt">external</span><span class="w"></span>
<span class="w">        </span>virtual<span class="w"></span>
<span class="w">        </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountA</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountB</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">liquidity</span><span class="w"></span>
<span class="w">        </span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>ensure<span class="p">(</span>deadline<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span>amountA<span class="p">,</span><span class="w"> </span>amountB<span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>_addLiquidity<span class="p">(</span>tokenA<span class="p">,</span><span class="w"> </span>tokenB<span class="p">,</span><span class="w"> </span>amountADesired<span class="p">,</span><span class="w"> </span>amountBDesired<span class="p">,</span><span class="w"> </span>amountAMin<span class="p">,</span><span class="w"> </span>amountBMin<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">pair</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>OpenMevLibrary<span class="p">.</span>pairFor<span class="p">(</span>OpenMevLibrary<span class="p">.</span>SUSHI_FACTORY<span class="p">,</span><span class="w"> </span>tokenA<span class="p">,</span><span class="w"> </span>tokenB<span class="p">);</span><span class="w"></span>
<span class="w">        </span>ERC20<span class="p">(</span>tokenA<span class="p">).</span>safeTransferFrom<span class="p">(</span><span class="k">msg.sender</span><span class="p">,</span><span class="w"> </span>pair<span class="p">,</span><span class="w"> </span>amountA<span class="p">);</span><span class="w"></span>
<span class="w">        </span>ERC20<span class="p">(</span>tokenB<span class="p">).</span>safeTransferFrom<span class="p">(</span><span class="k">msg.sender</span><span class="p">,</span><span class="w"> </span>pair<span class="p">,</span><span class="w"> </span>amountB<span class="p">);</span><span class="w"></span>
<span class="w">        </span>liquidity<span class="w"> </span><span class="o">=</span><span class="w"> </span>IUniswapV2Pair<span class="p">(</span>pair<span class="p">).</span>mint<span class="p">(</span>to<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span></pre></div>
            </td>
          </tr>
          
          <tr id="section-7">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
                <h4>@notice</h4> <p> Adds liquidity to an ERC-20⇄WETH pool with ETH. msg.sender should have already given the router an allowance of at least amountTokenDesired on token. msg.value is treated as a amountETHDesired. Leftover ETH, if any, is returned to msg.sender <br />
@param token Token in pool <br />
@param amountTokenDesired Amount of token desired to add to pool <br />
@param amountTokenMin Minimum amount of token, can be 0 <br />
@param amountETHMin Minimum amount of ETH, can be 0 <br />
@param to Address to receive liquidity token <br />
@param deadline Unix timestamp in seconds after which the transaction will revert <br />
@return amountToken exact amount of token added to pool <br />
@return amountETH exact amount of ETH added to pool <br />
@return liquidity amount of liquidity token received <br /></p>

            </td>
            <td class="code">
                <div class="highlight"><pre><span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">addLiquidityETH</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">token</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountTokenDesired</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountTokenMin</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountETHMin</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">to</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">deadline</span><span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="kt">external</span><span class="w"></span>
<span class="w">        </span><span class="kt">payable</span><span class="w"></span>
<span class="w">        </span>virtual<span class="w"></span>
<span class="w">        </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountToken</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountETH</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">liquidity</span><span class="w"></span>
<span class="w">        </span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>ensure<span class="p">(</span>deadline<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">weth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>WETH09<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span>amountToken<span class="p">,</span><span class="w"> </span>amountETH<span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>_addLiquidity<span class="p">(</span><span class="w"></span>
<span class="w">            </span>token<span class="p">,</span><span class="w"></span>
<span class="w">            </span>weth<span class="p">,</span><span class="w"></span>
<span class="w">            </span>amountTokenDesired<span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="k">msg.value</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span>amountTokenMin<span class="p">,</span><span class="w"></span>
<span class="w">            </span>amountETHMin<span class="w"></span>
<span class="w">        </span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">pair</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>OpenMevLibrary<span class="p">.</span>pairFor<span class="p">(</span>OpenMevLibrary<span class="p">.</span>SUSHI_FACTORY<span class="p">,</span><span class="w"> </span>token<span class="p">,</span><span class="w"> </span>weth<span class="p">);</span><span class="w"></span>
<span class="w">        </span>ERC20<span class="p">(</span>token<span class="p">).</span>safeTransferFrom<span class="p">(</span><span class="k">msg.sender</span><span class="p">,</span><span class="w"> </span>pair<span class="p">,</span><span class="w"> </span>amountToken<span class="p">);</span><span class="w"></span>
<span class="w">        </span>IWETH<span class="p">(</span>weth<span class="p">).</span>deposit<span class="p">{</span><span class="w"> </span>value<span class="p">:</span><span class="w"> </span>amountETH<span class="w"> </span><span class="p">}();</span><span class="w"></span>
<span class="w">        </span>ERC20<span class="p">(</span>weth<span class="p">).</span>safeTransfer<span class="p">(</span>pair<span class="p">,</span><span class="w"> </span>amountETH<span class="p">);</span><span class="w"></span>
<span class="w">        </span>liquidity<span class="w"> </span><span class="o">=</span><span class="w"> </span>IUniswapV2Pair<span class="p">(</span>pair<span class="p">).</span>mint<span class="p">(</span>to<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// refund dust eth, if any</span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span><span class="k">msg.value</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span>amountETH<span class="p">)</span><span class="w"> </span>SafeTransferLib<span class="p">.</span>safeTransferETH<span class="p">(</span><span class="k">msg.sender</span><span class="p">,</span><span class="w"> </span><span class="k">msg.value</span><span class="w"> </span><span class="o">-</span><span class="w"> </span>amountETH<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span></pre></div>
            </td>
          </tr>
          
          <tr id="section-8">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
                <p>**** REMOVE LIQUIDITY ****
@notice Removes liquidity from an ERC-20⇄ERC-20 pool. msg.sender should have already given the router an allowance of at least liquidity on the pool. <br />
@param tokenA Token in pool <br />
@param tokenB Token in pool <br />
@param liquidity Amount of liquidity tokens to remove <br />
@param amountAMin Minimum amount of token A, can be 0 <br />
@param amountBMin Minimum amount of token B, can be 0 <br />
@param to Address to receive pool tokens <br />
@param deadline Unix timestamp in seconds after which the transaction will revert <br />
@return amountA Amount of token A received
@return amountB Amount of token B received <br /></p>

            </td>
            <td class="code">
                <div class="highlight"><pre><span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">removeLiquidity</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">tokenA</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">tokenB</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">liquidity</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountAMin</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountBMin</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">to</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">deadline</span><span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>virtual<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountA</span><span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountB</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>ensure<span class="p">(</span>deadline<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">pair</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>OpenMevLibrary<span class="p">.</span>pairFor<span class="p">(</span>OpenMevLibrary<span class="p">.</span>SUSHI_FACTORY<span class="p">,</span><span class="w"> </span>tokenA<span class="p">,</span><span class="w"> </span>tokenB<span class="p">);</span><span class="w"></span>
<span class="w">        </span>ERC20<span class="p">(</span>pair<span class="p">).</span>safeTransferFrom<span class="p">(</span><span class="k">msg.sender</span><span class="p">,</span><span class="w"> </span>pair<span class="p">,</span><span class="w"> </span>liquidity<span class="p">);</span><span class="w"> </span><span class="c1">// send liquidity to pair</span>
<span class="w">        </span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amount0</span><span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amount1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>IUniswapV2Pair<span class="p">(</span>pair<span class="p">).</span>burn<span class="p">(</span>to<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">token0</span><span class="p">,</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>OpenMevLibrary<span class="p">.</span>sortTokens<span class="p">(</span>tokenA<span class="p">,</span><span class="w"> </span>tokenB<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span>amountA<span class="p">,</span><span class="w"> </span>amountB<span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>tokenA<span class="w"> </span><span class="o">==</span><span class="w"> </span>token0<span class="w"> </span><span class="err">?</span><span class="w"> </span><span class="p">(</span>amount0<span class="p">,</span><span class="w"> </span>amount1<span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">(</span>amount1<span class="p">,</span><span class="w"> </span>amount0<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>amountA<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>amountAMin<span class="p">)</span><span class="w"> </span>revert<span class="w"> </span>InsufficientAAmount<span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>amountB<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>amountBMin<span class="p">)</span><span class="w"> </span>revert<span class="w"> </span>InsufficientBAmount<span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span></pre></div>
            </td>
          </tr>
          
          <tr id="section-9">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
                <h4>@notice</h4> <p> Removes liquidity from an ERC-20⇄WETH pool and receive ETH. msg.sender should have already given the router an allowance of at least liquidity on the pool. <br />
@param token Token in pool <br />
@param liquidity Amount of liquidity tokens to remove <br />
@param amountTokenMin Minimum amount of token, can be 0 <br />
@param amountETHMin Minimum amount of ETH, can be 0 <br />
@param to Address to receive pool tokens <br />
@param deadline Unix timestamp in seconds after which the transaction will revert <br />
@return amountToken Amount of token received
@return amountETH Amount of ETH received <br /></p>

            </td>
            <td class="code">
                <div class="highlight"><pre><span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">removeLiquidityETH</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">token</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">liquidity</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountTokenMin</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountETHMin</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">to</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">deadline</span><span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>virtual<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountToken</span><span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountETH</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">weth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>WETH09<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">balanceBefore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>ERC20<span class="p">(</span>token<span class="p">).</span>balanceOf<span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="kt">this</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span>amountToken<span class="p">,</span><span class="w"> </span>amountETH<span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>removeLiquidity<span class="p">(</span><span class="w"></span>
<span class="w">            </span>token<span class="p">,</span><span class="w"></span>
<span class="w">            </span>weth<span class="p">,</span><span class="w"></span>
<span class="w">            </span>liquidity<span class="p">,</span><span class="w"></span>
<span class="w">            </span>amountTokenMin<span class="p">,</span><span class="w"></span>
<span class="w">            </span>amountETHMin<span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="kt">address</span><span class="p">(</span><span class="kt">this</span><span class="p">),</span><span class="w"></span>
<span class="w">            </span>deadline<span class="w"></span>
<span class="w">        </span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// exploit check from fee-on-transfer tokens</span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>amountToken<span class="w"> </span><span class="o">!=</span><span class="w"> </span>ERC20<span class="p">(</span>token<span class="p">).</span>balanceOf<span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="kt">this</span><span class="p">))</span><span class="w"> </span><span class="o">-</span><span class="w"> </span>balanceBefore<span class="p">)</span><span class="w"> </span>revert<span class="w"> </span>TokenIsFeeOnTransfer<span class="p">();</span><span class="w"></span>
<span class="w">        </span>ERC20<span class="p">(</span>token<span class="p">).</span>safeTransfer<span class="p">(</span>to<span class="p">,</span><span class="w"> </span>amountToken<span class="p">);</span><span class="w"></span>
<span class="w">        </span>IWETH<span class="p">(</span>weth<span class="p">).</span>withdraw<span class="p">(</span>amountETH<span class="p">);</span><span class="w"></span>
<span class="w">        </span>SafeTransferLib<span class="p">.</span>safeTransferETH<span class="p">(</span>to<span class="p">,</span><span class="w"> </span>amountETH<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span></pre></div>
            </td>
          </tr>
          
          <tr id="section-10">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
                <h4>@notice</h4> <p> Removes liquidity from an ERC-20⇄ERC-20 pool without pre-approval, thanks to permit. <br />
@param tokenA Token in pool <br />
@param tokenB Token in pool <br />
@param liquidity Amount of liquidity tokens to remove <br />
@param amountAMin Minimum amount of token A, can be 0 <br />
@param amountBMin Minimum amount of token B, can be 0 <br />
@param to Address to receive pool tokens <br />
@param deadline Unix timestamp in seconds after which the transaction will revert <br />
@param approveMax Whether or not the approval amount in the signature is for liquidity or uint(-1) <br />
@param v The v component of the permit signature <br />
@param r The r component of the permit signature <br />
@param s The s component of the permit signature <br />
@return amountA Amount of token A received
@return amountB Amount of token B received <br /></p>

            </td>
            <td class="code">
                <div class="highlight"><pre><span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">removeLiquidityWithPermit</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">tokenA</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">tokenB</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">liquidity</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountAMin</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountBMin</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">to</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">deadline</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="nv">approveMax</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint8</span><span class="w"> </span><span class="nv">v</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">r</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">s</span><span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>virtual<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountA</span><span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountB</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>IUniswapV2Pair<span class="p">(</span>OpenMevLibrary<span class="p">.</span>pairFor<span class="p">(</span>OpenMevLibrary<span class="p">.</span>SUSHI_FACTORY<span class="p">,</span><span class="w"> </span>tokenA<span class="p">,</span><span class="w"> </span>tokenB<span class="p">)).</span>permit<span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="k">msg.sender</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="kt">address</span><span class="p">(</span><span class="kt">this</span><span class="p">),</span><span class="w"></span>
<span class="w">            </span>approveMax<span class="w"> </span><span class="err">?</span><span class="w"> </span>type<span class="p">(</span><span class="kt">uint256</span><span class="p">).</span>max<span class="w"> </span><span class="p">:</span><span class="w"> </span>liquidity<span class="p">,</span><span class="w"></span>
<span class="w">            </span>deadline<span class="p">,</span><span class="w"></span>
<span class="w">            </span>v<span class="p">,</span><span class="w"></span>
<span class="w">            </span>r<span class="p">,</span><span class="w"></span>
<span class="w">            </span>s<span class="w"></span>
<span class="w">        </span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span>amountA<span class="p">,</span><span class="w"> </span>amountB<span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>removeLiquidity<span class="p">(</span>tokenA<span class="p">,</span><span class="w"> </span>tokenB<span class="p">,</span><span class="w"> </span>liquidity<span class="p">,</span><span class="w"> </span>amountAMin<span class="p">,</span><span class="w"> </span>amountBMin<span class="p">,</span><span class="w"> </span>to<span class="p">,</span><span class="w"> </span>deadline<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span></pre></div>
            </td>
          </tr>
          
          <tr id="section-11">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
                <h4>@notice</h4> <p> Removes liquidity from an ERC-20⇄WETTH pool and receive ETH without pre-approval, thanks to permit <br />
@param token Token in pool <br />
@param liquidity Amount of liquidity tokens to remove <br />
@param amountTokenMin Minimum amount of token, can be 0 <br />
@param amountETHMin Minimum amount of ETH, can be 0 <br />
@param to Address to receive pool tokens <br />
@param deadline Unix timestamp in seconds after which the transaction will revert <br />
@param approveMax Whether or not the approval amount in the signature is for liquidity or uint(-1) <br />
@param v The v component of the permit signature <br />
@param r The r component of the permit signature <br />
@param s The s component of the permit signature <br />
@return amountToken Amount of token received
@return amountETH Amount of ETH received <br /></p>

            </td>
            <td class="code">
                <div class="highlight"><pre><span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">removeLiquidityETHWithPermit</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">token</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">liquidity</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountTokenMin</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountETHMin</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">to</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">deadline</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="nv">approveMax</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint8</span><span class="w"> </span><span class="nv">v</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">r</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">s</span><span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>virtual<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountToken</span><span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountETH</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>IUniswapV2Pair<span class="p">(</span>OpenMevLibrary<span class="p">.</span>pairFor<span class="p">(</span>OpenMevLibrary<span class="p">.</span>SUSHI_FACTORY<span class="p">,</span><span class="w"> </span>token<span class="p">,</span><span class="w"> </span>WETH09<span class="p">)).</span>permit<span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="k">msg.sender</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="kt">address</span><span class="p">(</span><span class="kt">this</span><span class="p">),</span><span class="w"></span>
<span class="w">            </span>approveMax<span class="w"> </span><span class="err">?</span><span class="w"> </span>type<span class="p">(</span><span class="kt">uint256</span><span class="p">).</span>max<span class="w"> </span><span class="p">:</span><span class="w"> </span>liquidity<span class="p">,</span><span class="w"></span>
<span class="w">            </span>deadline<span class="p">,</span><span class="w"></span>
<span class="w">            </span>v<span class="p">,</span><span class="w"></span>
<span class="w">            </span>r<span class="p">,</span><span class="w"></span>
<span class="w">            </span>s<span class="w"></span>
<span class="w">        </span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span>amountToken<span class="p">,</span><span class="w"> </span>amountETH<span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>removeLiquidityETH<span class="p">(</span>token<span class="p">,</span><span class="w"> </span>liquidity<span class="p">,</span><span class="w"> </span>amountTokenMin<span class="p">,</span><span class="w"> </span>amountETHMin<span class="p">,</span><span class="w"> </span>to<span class="p">,</span><span class="w"> </span>deadline<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span></pre></div>
            </td>
          </tr>
          
          <tr id="section-12">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
                <h4>@notice</h4> <p> Identical to removeLiquidityETH, but succeeds for tokens that take a fee on transfer. msg.sender should have already given the router an allowance of at least liquidity on the pool. <br />
@param token Token in pool <br />
@param liquidity Amount of liquidity tokens to remove <br />
@param amountTokenMin Minimum amount of token, can be 0 <br />
@param amountETHMin Minimum amount of ETH, can be 0 <br />
@param to Address to receive pool tokens <br />
@param deadline Unix timestamp in seconds after which the transaction will revert <br />
@return amountETH Amount of ETH received <br /></p>

            </td>
            <td class="code">
                <div class="highlight"><pre><span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">removeLiquidityETHSupportingFeeOnTransferTokens</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">token</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">liquidity</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountTokenMin</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountETHMin</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">to</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">deadline</span><span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>virtual<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountETH</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">weth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>WETH09<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">balanceBefore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>ERC20<span class="p">(</span>token<span class="p">).</span>balanceOf<span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="kt">this</span><span class="p">));</span><span class="w"></span>
<span class="w">        </span><span class="p">(,</span><span class="w"> </span>amountETH<span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>removeLiquidity<span class="p">(</span>token<span class="p">,</span><span class="w"> </span>weth<span class="p">,</span><span class="w"> </span>liquidity<span class="p">,</span><span class="w"> </span>amountTokenMin<span class="p">,</span><span class="w"> </span>amountETHMin<span class="p">,</span><span class="w"> </span><span class="kt">address</span><span class="p">(</span><span class="kt">this</span><span class="p">),</span><span class="w"> </span>deadline<span class="p">);</span><span class="w"></span>
<span class="w">        </span>ERC20<span class="p">(</span>token<span class="p">).</span>safeTransfer<span class="p">(</span>to<span class="p">,</span><span class="w"> </span>ERC20<span class="p">(</span>token<span class="p">).</span>balanceOf<span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="kt">this</span><span class="p">))</span><span class="w"> </span><span class="o">-</span><span class="w"> </span>balanceBefore<span class="p">);</span><span class="w"></span>
<span class="w">        </span>IWETH<span class="p">(</span>weth<span class="p">).</span>withdraw<span class="p">(</span>amountETH<span class="p">);</span><span class="w"></span>
<span class="w">        </span>SafeTransferLib<span class="p">.</span>safeTransferETH<span class="p">(</span>to<span class="p">,</span><span class="w"> </span>amountETH<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span></pre></div>
            </td>
          </tr>
          
          <tr id="section-13">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
                <h4>@notice</h4> <p> Identical to removeLiquidityETHWithPermit, but succeeds for tokens that take a fee on transfer. <br />
@param token Token in pool <br />
@param liquidity Amount of liquidity tokens to remove <br />
@param amountTokenMin Minimum amount of token, can be 0 <br />
@param amountETHMin Minimum amount of ETH, can be 0 <br />
@param to Address to receive pool tokens <br />
@param deadline Unix timestamp in seconds after which the transaction will revert <br />
@param approveMax Whether or not the approval amount in the signature is for liquidity or uint(-1) <br />
@param v The v component of the permit signature <br />
@param r The r component of the permit signature <br />
@param s The s component of the permit signature <br />
@return amountETH Amount of ETH received <br /></p>

            </td>
            <td class="code">
                <div class="highlight"><pre><span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">removeLiquidityETHWithPermitSupportingFeeOnTransferTokens</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">token</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">liquidity</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountTokenMin</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountETHMin</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">to</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">deadline</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="nv">approveMax</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint8</span><span class="w"> </span><span class="nv">v</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">r</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">s</span><span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>virtual<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountETH</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>IUniswapV2Pair<span class="p">(</span>OpenMevLibrary<span class="p">.</span>pairFor<span class="p">(</span>OpenMevLibrary<span class="p">.</span>SUSHI_FACTORY<span class="p">,</span><span class="w"> </span>token<span class="p">,</span><span class="w"> </span>WETH09<span class="p">)).</span>permit<span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="k">msg.sender</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="kt">address</span><span class="p">(</span><span class="kt">this</span><span class="p">),</span><span class="w"></span>
<span class="w">            </span>approveMax<span class="w"> </span><span class="err">?</span><span class="w"> </span>type<span class="p">(</span><span class="kt">uint256</span><span class="p">).</span>max<span class="w"> </span><span class="p">:</span><span class="w"> </span>liquidity<span class="p">,</span><span class="w"></span>
<span class="w">            </span>deadline<span class="p">,</span><span class="w"></span>
<span class="w">            </span>v<span class="p">,</span><span class="w"></span>
<span class="w">            </span>r<span class="p">,</span><span class="w"></span>
<span class="w">            </span>s<span class="w"></span>
<span class="w">        </span><span class="p">);</span><span class="w"></span>
<span class="w">        </span>amountETH<span class="w"> </span><span class="o">=</span><span class="w"> </span>removeLiquidityETHSupportingFeeOnTransferTokens<span class="p">(</span><span class="w"></span>
<span class="w">            </span>token<span class="p">,</span><span class="w"></span>
<span class="w">            </span>liquidity<span class="p">,</span><span class="w"></span>
<span class="w">            </span>amountTokenMin<span class="p">,</span><span class="w"></span>
<span class="w">            </span>amountETHMin<span class="p">,</span><span class="w"></span>
<span class="w">            </span>to<span class="p">,</span><span class="w"></span>
<span class="w">            </span>deadline<span class="w"></span>
<span class="w">        </span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span></pre></div>
            </td>
          </tr>
          
          <tr id="section-14">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
                <h4>@notice</h4> <p> Internal core swap. Requires the initial amount to have already been sent to the first pair. <br />
@param _to Address of receiver <br />
@param swaps Array of user swap data</p> <br />

            </td>
            <td class="code">
                <div class="highlight"><pre><span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">_swap</span><span class="p">(</span><span class="kt">address</span><span class="w"> </span><span class="nv">_to</span><span class="p">,</span><span class="w"> </span>OpenMevLibrary<span class="p">.</span>Swap<span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>swaps<span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="kt">internal</span><span class="w"></span>
<span class="w">        </span>virtual<span class="w"></span>
<span class="w">        </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>amounts<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>swaps<span class="p">.</span>length<span class="p">;</span><span class="w"></span>
<span class="w">        </span>amounts<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="kt">uint256</span><span class="p">[](</span>_inc<span class="p">(</span>length<span class="p">));</span><span class="w"></span>
<span class="w">        </span>amounts<span class="p">[</span><span class="m m-Decimal">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>swaps<span class="p">[</span><span class="m m-Decimal">0</span><span class="p">].</span>amountIn<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">i</span><span class="p">;</span><span class="w"> </span>i<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>length<span class="p">;</span><span class="w"> </span>i<span class="w"> </span><span class="o">=</span><span class="w"> </span>_inc<span class="p">(</span>i<span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountOut</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>swaps<span class="p">[</span>i<span class="p">].</span>amountOut<span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amount0Out</span><span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amount1Out</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>swaps<span class="p">[</span>i<span class="p">].</span>isReverse<span class="w"></span>
<span class="w">                    </span><span class="err">?</span><span class="w"> </span><span class="p">(</span>amountOut<span class="p">,</span><span class="w"> </span><span class="kt">uint256</span><span class="p">(</span><span class="m m-Decimal">0</span><span class="p">))</span><span class="w"></span>
<span class="w">                    </span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="p">(</span><span class="m m-Decimal">0</span><span class="p">),</span><span class="w"> </span>amountOut<span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="kt">address</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>i<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>_dec<span class="p">(</span>length<span class="p">)</span><span class="w"> </span><span class="err">?</span><span class="w"> </span>swaps<span class="p">[</span>_inc<span class="p">(</span>i<span class="p">)].</span>pair<span class="w"> </span><span class="p">:</span><span class="w"> </span>_to<span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="kt">address</span><span class="w"> </span><span class="nv">pair</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>swaps<span class="p">[</span>i<span class="p">].</span>pair<span class="p">;</span><span class="w"></span>
<span class="w">                </span>_asmSwap<span class="p">(</span>pair<span class="p">,</span><span class="w"> </span>amount0Out<span class="p">,</span><span class="w"> </span>amount1Out<span class="p">,</span><span class="w"> </span>to<span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span>amounts<span class="p">[</span>_inc<span class="p">(</span>i<span class="p">)]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>amountOut<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span></pre></div>
            </td>
          </tr>
          
          <tr id="section-15">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
                <h4>@notice</h4> <p> Swaps an exact amount of input tokens for as many output tokens as possible, along the route determined by the path. The first element of path is the input token, the last is the output token, and any intermediate elements represent intermediate pairs to trade through. msg.sender should have already given the router an allowance of at least amountIn on the input token. <br />
<br /> @dev Require has been replaced with revert for gas optimization. Fallback alternate router check for insufficient output amount. Attempt to back-run swaps. <br />
@param amountIn Amount of input tokens to send. <br />
@param amountOutMin Minimum amount of output tokens that must be received <br />
@param path Array of token addresses. path.length must be &gt;= 2. Pools for each consecutive pair of addresses must exist and have liquidity <br />
@param to Address of receiver <br />
@param deadline Unix timestamp in seconds after which the transaction will revert <br />
@return amounts Array of input token amount and all <br /> subsequent output token amounts <br /></p>

            </td>
            <td class="code">
                <div class="highlight"><pre><span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">swapExactTokensForTokens</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountIn</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountOutMin</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="p">[]</span><span class="w"> </span>calldata<span class="w"> </span>path<span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">to</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">deadline</span><span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>virtual<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>amounts<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>ensure<span class="p">(</span>deadline<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">factory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>OpenMevLibrary<span class="p">.</span>SUSHI_FACTORY<span class="p">;</span><span class="w"></span>
<span class="w">        </span>OpenMevLibrary<span class="p">.</span>Swap<span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>swaps<span class="w"> </span><span class="o">=</span><span class="w"> </span>OpenMevLibrary<span class="p">.</span>getSwapsOut<span class="p">(</span>factory<span class="p">,</span><span class="w"> </span>amountIn<span class="p">,</span><span class="w"> </span>path<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>swaps<span class="p">.</span>length<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>swaps<span class="p">[</span>_dec<span class="p">(</span>length<span class="p">)].</span>amountOut<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>amountOutMin<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="c1">// Change 1 -&gt; fallback for insufficient output amount, check backup router</span>
<span class="w">            </span>factory<span class="w"> </span><span class="o">=</span><span class="w"> </span>BACKUP_FACTORY<span class="p">;</span><span class="w"></span>
<span class="w">            </span>swaps<span class="w"> </span><span class="o">=</span><span class="w"> </span>OpenMevLibrary<span class="p">.</span>getSwapsOut<span class="p">(</span>factory<span class="p">,</span><span class="w"> </span>amountIn<span class="p">,</span><span class="w"> </span>path<span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>swaps<span class="p">[</span>_dec<span class="p">(</span>length<span class="p">)].</span>amountOut<span class="w"> </span><span class="o">&lt;</span><span class="w"> </span>amountOutMin<span class="p">)</span><span class="w"> </span>revert<span class="w"> </span>InsufficientOutputAmount<span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span>ERC20<span class="p">(</span>path<span class="p">[</span><span class="m m-Decimal">0</span><span class="p">]).</span>safeTransferFrom<span class="p">(</span><span class="k">msg.sender</span><span class="p">,</span><span class="w"> </span>swaps<span class="p">[</span><span class="m m-Decimal">0</span><span class="p">].</span>pair<span class="p">,</span><span class="w"> </span>amountIn<span class="p">);</span><span class="w"></span>
<span class="w">        </span>amounts<span class="w"> </span><span class="o">=</span><span class="w"> </span>_swap<span class="p">(</span>to<span class="p">,</span><span class="w"> </span>swaps<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Change 2 -&gt; back-run swaps</span>
<span class="w">        </span>_backrunSwaps<span class="p">(</span>factory<span class="p">,</span><span class="w"> </span>swaps<span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span></pre></div>
            </td>
          </tr>
          
          <tr id="section-16">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
                <h4>@notice</h4> <p> Receive an exact amount of output tokens for as few input tokens as possible, along the route determined by the path. msg.sender should have already given the router an allowance of at least amountInMax on the input token. <br />
<br /> @dev Require has been replaced with revert for gas optimization. Fallback alternate router check for insufficient output amount. Attempt to back-run swaps. <br />
@param amountOut Amount of output tokens to receive <br />
@param amountInMax Maximum amount of input tokens <br />
@param path Array of token addresses. path.length must be &gt;= 2. Pools for each consecutive pair of addresses must exist and have liquidity <br />
@param to Address of receiver <br />
@param deadline Unix timestamp in seconds after which the transaction will revert <br />
@return amounts Array of input token amount and all <br /> subsequent output token amounts <br /></p>

            </td>
            <td class="code">
                <div class="highlight"><pre><span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">swapTokensForExactTokens</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountOut</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">amountInMax</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="p">[]</span><span class="w"> </span>calldata<span class="w"> </span>path<span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">to</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="kt">uint256</span><span class="w"> </span><span class="nv">deadline</span><span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span>virtual<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>amounts<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>ensure<span class="p">(</span>deadline<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">address</span><span class="w"> </span><span class="nv">factory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>OpenMevLibrary<span class="p">.</span>SUSHI_FACTORY<span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="c1">// amounts = OpenMevLibrary.getAmountsIn(factory, amountOut, path);</span>
<span class="w">        </span>OpenMevLibrary<span class="p">.</span>Swap<span class="p">[]</span><span class="w"> </span><span class="kt">memory</span><span class="w"> </span>swaps<span class="w"> </span><span class="o">=</span><span class="w"> </span>OpenMevLibrary<span class="p">.</span>getSwapsIn<span class="p">(</span>factory<span class="p">,</span><span class="w"> </span>amountOut<span class="p">,</span><span class="w"> </span>path<span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>swaps<span class="p">[</span><span class="m m-Decimal">0</span><span class="p">].</span>amountIn<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span>amountInMax<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span>factory<span class="w"> </span><span class="o">=</span><span class="w"> </span>BACKUP_FACTORY<span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="c1">// Change 1 -&gt; fallback for insufficient output amount, check backup router</span>
<span class="w">            </span>swaps<span class="w"> </span><span class="o">=</span><span class="w"> </span>OpenMevLibrary<span class="p">.</span>getSwapsIn<span class="p">(</span>factory<span class="p">,</span><span class="w"> </span>amountOut<span class="p">,</span><span class="w"> </span>path<span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>swaps<span class="p">[</span><span class="m m-Decimal">0</span><span class="p">].</span>amountIn<span class="w"> </span><span class="o">&gt;</span><span class="w"> </span>amountInMax<span class="p">)</span><span class="w"> </span>revert<span class="w"> </span>ExcessiveInputAmount<span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

          <tr id="section-36">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
                <h4>@notice</h4> <p> Uint256 zero check gas saver <br />
@param value Number to check</p> <br />

            </td>
            <td class="code">
                <div class="highlight"><pre><span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">_isZero</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="nv">boolValue</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>assembly<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span>boolValue<span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span>iszero<span class="p">(</span>value<span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span></pre></div>
            </td>
          </tr>
          
          <tr id="section-37">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
                <h4>@notice</h4> <p> Uint256 not zero check gas saver <br />
@param value Number to check</p> <br />

            </td>
            <td class="code">
                <div class="highlight"><pre><span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">_isNonZero</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="nv">boolValue</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>assembly<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span>boolValue<span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span>iszero<span class="p">(</span>iszero<span class="p">(</span>value<span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span></pre></div>
            </td>
          </tr>
          
          <tr id="section-38">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
                <h4>@notice</h4> <p> Unchecked increment gas saver for loops <br />
@param i Number to increment</p> <br />

            </td>
            <td class="code">
                <div class="highlight"><pre><span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">_inc</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">i</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>unchecked<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kt">return</span><span class="w"> </span>i<span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span></pre></div>
            </td>
          </tr>
          
          <tr id="section-39">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
                <h4>@notice</h4> <p> Unchecked decrement gas saver for loops <br />
@param i Number to decrement</p> <br />

            </td>
            <td class="code">
                <div class="highlight"><pre><span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">_dec</span><span class="p">(</span><span class="kt">uint256</span><span class="w"> </span><span class="nv">i</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>pure<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint256</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span>unchecked<span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kt">return</span><span class="w"> </span>i<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m m-Decimal">1</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span></pre></div>
            </td>
          </tr>
          
          <tr id="section-40">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
                <h4>@notice</h4> <p> Function to receive Ether. msg.data must be empty</p> <br />

            </td>
            <td class="code">
                <div class="highlight"><pre><span class="w">    </span>receive<span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{}</span><span class="w"></span></pre></div>
            </td>
          </tr>
          
          <tr id="section-41">
            <td class="docs">
              <div class="pilwrap">
                  <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
                <h4>@notice</h4> <p> Fallback function is called when msg.data is not empty</p> <br />

            </td>
            <td class="code">
                <div class="highlight"><pre><span class="w">    </span>fallback<span class="p">()</span><span class="w"> </span><span class="kt">external</span><span class="w"> </span><span class="kt">payable</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

</pre></div>
            </td>
          </tr>
          
      </tbody>
    </table>
  </div>
</body>
</html>
